<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=1100"/>
<title>Clumsy Bird</title>
<link href="https://fonts.googleapis.com/css2?family=Bangers&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  *{margin:0;padding:0;box-sizing:border-box}

  body{
    background: radial-gradient(ellipse at 60% 40%, #0f2a5e 0%, #0a1628 60%, #050d1a 100%);
    display:flex;align-items:center;justify-content:center;
    min-height:100vh;width:100vw;
    font-family:'Nunito',sans-serif;
    overflow:hidden;
    user-select:none;
  }

  /* ‚îÄ‚îÄ Starfield bg ‚îÄ‚îÄ */
  body::before{
    content:'';position:fixed;inset:0;
    background-image:
      radial-gradient(1px 1px at 10% 15%, rgba(255,255,255,.7) 0%, transparent 100%),
      radial-gradient(1px 1px at 25% 40%, rgba(255,255,255,.5) 0%, transparent 100%),
      radial-gradient(1.5px 1.5px at 40% 8%,  rgba(255,255,255,.6) 0%, transparent 100%),
      radial-gradient(1px 1px at 55% 60%, rgba(255,255,255,.4) 0%, transparent 100%),
      radial-gradient(1px 1px at 70% 25%, rgba(255,255,255,.7) 0%, transparent 100%),
      radial-gradient(1.5px 1.5px at 82% 70%, rgba(255,255,255,.5) 0%, transparent 100%),
      radial-gradient(1px 1px at 93% 12%, rgba(255,255,255,.6) 0%, transparent 100%),
      radial-gradient(1px 1px at 5%  80%, rgba(255,255,255,.4) 0%, transparent 100%),
      radial-gradient(1px 1px at 48% 88%, rgba(255,255,255,.5) 0%, transparent 100%);
    pointer-events:none;z-index:0;
  }

  /* ‚îÄ‚îÄ Main layout: sidebar + game ‚îÄ‚îÄ */
  #layout{
    position:relative;z-index:1;
    display:flex;align-items:center;gap:36px;
    width:1060px;max-width:98vw;
  }

  /* ‚îÄ‚îÄ Left sidebar ‚îÄ‚îÄ */
  #sidebar-left{
    flex:0 0 220px;
    display:flex;flex-direction:column;gap:20px;
  }

  .sidebar-logo{
    font-family:'Bangers',cursive;
    font-size:64px;line-height:0.95;
    letter-spacing:4px;
    color:#ffe566;
    text-shadow:4px 4px 0 #c97000, 0 6px 20px rgba(255,180,0,.3);
    animation:logoFloat 2.5s ease-in-out infinite;
  }
  .sidebar-logo span{display:block;font-size:22px;letter-spacing:6px;color:#7ec8f8;text-shadow:none;margin-top:4px;}
  @keyframes logoFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

  .side-card{
    background:rgba(255,255,255,0.06);
    border:1.5px solid rgba(255,255,255,0.12);
    border-radius:16px;
    padding:18px 20px;
    backdrop-filter:blur(8px);
  }
  .side-card h3{
    font-family:'Bangers',cursive;
    font-size:18px;letter-spacing:2px;
    color:#ffe566;margin-bottom:12px;
    text-transform:uppercase;
  }

  .key-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
  .key-row:last-child{margin-bottom:0}
  .key{
    display:inline-flex;align-items:center;justify-content:center;
    min-width:40px;height:36px;padding:0 10px;
    background:rgba(255,255,255,0.12);
    border:2px solid rgba(255,255,255,0.25);
    border-bottom:4px solid rgba(255,255,255,0.15);
    border-radius:8px;
    font-family:'Bangers',cursive;font-size:16px;letter-spacing:1px;
    color:white;
    box-shadow:0 2px 8px rgba(0,0,0,.3);
  }
  .key-desc{font-size:13px;color:rgba(255,255,255,.7);font-weight:700;}

  .live-score-box{text-align:center;padding:10px 0;}
  .live-score-label{font-size:12px;font-weight:900;letter-spacing:2px;color:rgba(255,255,255,.5);text-transform:uppercase;}
  .live-score-num{
    font-family:'Bangers',cursive;
    font-size:72px;line-height:1;
    color:#ffe566;
    text-shadow:3px 3px 0 #c97000;
    transition:transform .1s;
  }
  .live-score-num.pop{transform:scale(1.25);}
  .live-best-label{font-size:11px;font-weight:700;color:rgba(255,255,255,.4);margin-top:4px;}
  .live-best-num{font-family:'Bangers',cursive;font-size:26px;color:#7ec8f8;letter-spacing:1px;}

  /* ‚îÄ‚îÄ Game canvas wrapper ‚îÄ‚îÄ */
  #wrapper{
    position:relative;flex:0 0 auto;
    width:480px;height:640px;
    box-shadow:0 0 0 3px rgba(255,255,255,.08), 0 0 80px rgba(0,100,255,.2), 0 24px 60px rgba(0,0,0,.7);
    border-radius:16px;
    overflow:hidden;
    cursor:pointer;
  }
  canvas{display:block;}

  /* ‚îÄ‚îÄ Right sidebar ‚îÄ‚îÄ */
  #sidebar-right{
    flex:0 0 220px;
    display:flex;flex-direction:column;gap:20px;
  }

  .medal-showcase{
    text-align:center;
  }
  .medal-showcase h3{
    font-family:'Bangers',cursive;font-size:18px;letter-spacing:2px;
    color:#ffe566;margin-bottom:14px;text-transform:uppercase;
  }
  .medal-item{
    display:flex;align-items:center;gap:10px;
    padding:8px 10px;border-radius:10px;
    margin-bottom:6px;
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
  }
  .m-icon{font-size:22px;}
  .m-info{text-align:left;}
  .m-name{font-family:'Bangers',cursive;font-size:16px;letter-spacing:1px;color:white;}
  .m-req{font-size:11px;color:rgba(255,255,255,.45);font-weight:700;}

  .tip-card p{
    font-size:13px;color:rgba(255,255,255,.6);
    line-height:1.6;font-weight:700;
  }
  .tip-card p+p{margin-top:8px;}
  .tip-card .highlight{color:#ffe566;}

  /* ‚îÄ‚îÄ Overlay panels ‚îÄ‚îÄ */
  .panel{
    position:absolute;inset:0;
    display:flex;flex-direction:column;
    align-items:center;justify-content:center;
    pointer-events:none;
    transition:opacity .3s;
    z-index:10;
  }
  .panel.hidden{opacity:0;pointer-events:none;}
  .panel.visible{opacity:1;pointer-events:all;}

  #startPanel{background:rgba(0,0,0,.0);}

  .start-logo{
    font-family:'Bangers',cursive;
    font-size:80px;letter-spacing:5px;line-height:.95;
    color:#ffe566;
    text-shadow:5px 5px 0 #c97000, 0 8px 30px rgba(255,200,0,.4);
    text-align:center;
    animation:logoFloat 2.5s ease-in-out infinite;
  }
  .start-sub{
    font-size:16px;letter-spacing:4px;color:#7ec8f8;
    text-shadow:0 2px 8px rgba(0,0,0,.5);margin-top:6px;
    font-weight:900;text-transform:uppercase;
  }
  .start-hint{
    margin-top:44px;
    font-family:'Bangers',cursive;
    font-size:26px;letter-spacing:3px;color:white;
    text-shadow:2px 2px 0 rgba(0,0,0,.5);
    animation:blink 1.1s ease-in-out infinite;
    background:rgba(0,0,0,.3);
    padding:10px 28px;border-radius:30px;
    border:2px solid rgba(255,255,255,.15);
  }
  @keyframes blink{0%,100%{opacity:1}50%{opacity:.25}}

  /* Game Over card */
  #gameOverPanel{background:rgba(0,0,0,.4);backdrop-filter:blur(3px);}
  .go-card{
    background:#fffbe8;
    border:5px solid #d4a853;
    border-radius:22px;
    padding:30px 40px 26px;
    width:330px;
    text-align:center;
    box-shadow:0 12px 0 #b8832a, 0 20px 50px rgba(0,0,0,.5);
    animation:popIn .5s cubic-bezier(.175,.885,.32,1.275) both;
  }
  @keyframes popIn{
    from{transform:scale(.35) translateY(50px);opacity:0}
    to{transform:scale(1) translateY(0);opacity:1}
  }
  .go-title{
    font-family:'Bangers',cursive;font-size:54px;letter-spacing:3px;
    color:#e94e3d;text-shadow:3px 3px 0 #9b1a0d;line-height:1;
  }
  .score-table{
    background:#fff8d6;border:3px solid #d4a853;
    border-radius:12px;margin:16px 0 14px;overflow:hidden;
  }
  .score-row{
    display:flex;justify-content:space-between;align-items:center;
    padding:11px 18px;border-bottom:2px dashed #e0c87a;
  }
  .score-row:last-child{border-bottom:none;}
  .s-label{font-weight:900;font-size:13px;color:#7a5500;text-transform:uppercase;letter-spacing:1px;}
  .s-val{font-family:'Bangers',cursive;font-size:32px;color:#3b2200;letter-spacing:2px;}
  .medal{
    width:40px;height:40px;border-radius:50%;
    display:inline-flex;align-items:center;justify-content:center;
    font-size:21px;border:3px solid;box-shadow:0 3px 0 rgba(0,0,0,.2);
  }
  .medal-gold  {background:linear-gradient(135deg,#ffe566,#f5a800);border-color:#c98000;}
  .medal-silver{background:linear-gradient(135deg,#e8e8e8,#b0b0b0);border-color:#888;}
  .medal-bronze{background:linear-gradient(135deg,#f0c090,#c07840);border-color:#a05020;}
  .medal-none  {background:#e0e0e0;border-color:#aaa;font-size:18px;}
  .stars{display:inline-flex;gap:3px;vertical-align:middle;margin-left:8px;}
  .star{font-size:20px;filter:grayscale(1);}
  .star.lit{filter:none;animation:starPop .4s ease-out both;}
  @keyframes starPop{0%{transform:scale(0)}70%{transform:scale(1.3)}100%{transform:scale(1)}}
  .star:nth-child(1).lit{animation-delay:.6s}
  .star:nth-child(2).lit{animation-delay:.8s}
  .star:nth-child(3).lit{animation-delay:1s}
  .new-badge{
    display:inline-block;background:#f5c518;color:#7a4e00;
    font-size:10px;font-weight:900;padding:1px 7px;border-radius:20px;
    border:2px solid #c99600;text-transform:uppercase;letter-spacing:1px;
    margin-left:6px;vertical-align:middle;
    animation:pulse 1s ease-in-out infinite;
  }
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
  .btn-row{display:flex;gap:14px;margin-top:16px;}
  .btn{
    flex:1;padding:13px 8px;
    font-family:'Bangers',cursive;font-size:22px;letter-spacing:2px;
    border:none;border-radius:12px;cursor:pointer;outline:none;
    transition:transform .1s,box-shadow .1s;
  }
  .btn:active{transform:translateY(3px)!important;box-shadow:0 2px 0!important}
  .btn-play{
    background:linear-gradient(180deg,#7de84a,#4caf1e);color:#fff;
    text-shadow:1px 2px 0 #2a7000;border:3px solid #2a7000;box-shadow:0 5px 0 #2e7a00;
  }
  .btn-play:hover{transform:translateY(-2px);box-shadow:0 7px 0 #2e7a00}
  .btn-share{
    background:linear-gradient(180deg,#5bc8ff,#1a8fd1);color:#fff;
    text-shadow:1px 2px 0 #0056a0;border:3px solid #0056a0;box-shadow:0 5px 0 #0060b0;
  }
  .btn-share:hover{transform:translateY(-2px);box-shadow:0 7px 0 #0060b0}

  .toast{
    position:fixed;bottom:32px;left:50%;transform:translateX(-50%);
    background:rgba(0,0,0,.8);color:#fff;
    padding:10px 24px;border-radius:30px;
    font-size:14px;font-weight:700;
    opacity:0;pointer-events:none;transition:opacity .3s;
    white-space:nowrap;z-index:999;
  }
  .toast.show{opacity:1;}
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ Desktop layout ‚îÄ‚îÄ -->
<div id="layout">

  <!-- Left sidebar -->
  <div id="sidebar-left">
    <div class="sidebar-logo">
      CLUMSY<br>BIRD
      <span>ADVENTURE</span>
    </div>

    <div class="side-card">
      <h3>üéÆ Controls</h3>
      <div class="key-row">
        <span class="key">SPACE</span>
        <span class="key-desc">Flap wings</span>
      </div>
      <div class="key-row">
        <span class="key">‚Üë</span>
        <span class="key-desc">Flap wings</span>
      </div>
      <div class="key-row">
        <span class="key">Click</span>
        <span class="key-desc">Flap wings</span>
      </div>
    </div>

    <div class="side-card">
      <h3>üìä Score</h3>
      <div class="live-score-box">
        <div class="live-score-label">Current</div>
        <div class="live-score-num" id="liveScore">0</div>
        <div class="live-best-label">BEST</div>
        <div class="live-best-num" id="liveBest">0</div>
      </div>
    </div>
  </div>

  <!-- Game canvas -->
  <div id="wrapper">
    <canvas id="c"></canvas>

    <!-- Start Screen -->
    <div class="panel visible" id="startPanel">
      <div class="start-logo">CLUMSY<br>BIRD</div>
      <div class="start-sub">A Flappy Adventure</div>
      <canvas id="birdPreview" width="90" height="72" style="margin-top:28px;animation:logoFloat 2.5s ease-in-out infinite"></canvas>
      <div class="start-hint">PRESS SPACE TO START</div>
    </div>

    <!-- Game Over Screen -->
    <div class="panel hidden" id="gameOverPanel">
      <div class="go-card">
        <div class="go-title">GAME OVER!</div>
        <div class="score-table">
          <div class="score-row">
            <span class="s-label">Score</span>
            <span class="s-val" id="goScore">0</span>
          </div>
          <div class="score-row">
            <span class="s-label">Best <span class="new-badge" id="newBadge" style="display:none">New!</span></span>
            <span class="s-val" id="goBest">0</span>
          </div>
          <div class="score-row">
            <span class="s-label">Medal</span>
            <div>
              <span class="medal medal-none" id="goMedal">üíÄ</span>
              <span class="stars">
                <span class="star" id="st1">‚≠ê</span>
                <span class="star" id="st2">‚≠ê</span>
                <span class="star" id="st3">‚≠ê</span>
              </span>
            </div>
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-play" id="retryBtn">‚ñ∂ Play Again</button>
          <button class="btn btn-share" id="shareBtn">üîó Share</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Right sidebar -->
  <div id="sidebar-right">

    <div class="side-card medal-showcase">
      <h3>üèÖ Medals</h3>
      <div class="medal-item">
        <span class="m-icon">ü•á</span>
        <div class="m-info">
          <div class="m-name">Gold</div>
          <div class="m-req">Score 40+</div>
        </div>
      </div>
      <div class="medal-item">
        <span class="m-icon">ü•à</span>
        <div class="m-info">
          <div class="m-name">Silver</div>
          <div class="m-req">Score 20+</div>
        </div>
      </div>
      <div class="medal-item">
        <span class="m-icon">ü•â</span>
        <div class="m-info">
          <div class="m-name">Bronze</div>
          <div class="m-req">Score 5+</div>
        </div>
      </div>
      <div class="medal-item">
        <span class="m-icon">üíÄ</span>
        <div class="m-info">
          <div class="m-name">Nothing</div>
          <div class="m-req">Score 0‚Äì4</div>
        </div>
      </div>
    </div>

    <div class="side-card tip-card">
      <h3>üí° Tips</h3>
      <p>Tap <span class="highlight">early</span> ‚Äî the bird falls faster than you think!</p>
      <p>Aim for the <span class="highlight">center</span> of each gap.</p>
      <p>Stay <span class="highlight">calm</span> and keep a steady rhythm.</p>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CLUMSY BIRD  ‚Äì  full canvas game
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const W = 480, H = 640;
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = W; canvas.height = H;
canvas.style.width  = W+'px';
canvas.style.height = H+'px';

// ‚îÄ‚îÄ Live sidebar score
const liveScoreEl = document.getElementById('liveScore');
const liveBestEl  = document.getElementById('liveBest');
function updateSidebarScore(){
  liveScoreEl.textContent = score;
  liveBestEl.textContent  = best;
  liveScoreEl.classList.remove('pop');
  void liveScoreEl.offsetWidth;
  liveScoreEl.classList.add('pop');
  setTimeout(()=>liveScoreEl.classList.remove('pop'),150);
}

// ‚îÄ‚îÄ Panels & buttons
const startPanel    = document.getElementById('startPanel');
const gameOverPanel = document.getElementById('gameOverPanel');
const goScore       = document.getElementById('goScore');
const goBest        = document.getElementById('goBest');
const goMedal       = document.getElementById('goMedal');
const newBadge      = document.getElementById('newBadge');
const retryBtn      = document.getElementById('retryBtn');
const shareBtn      = document.getElementById('shareBtn');
const toast         = document.getElementById('toast');

// ‚îÄ‚îÄ State machine
const STATE = { START:0, PLAYING:1, DYING:2, DEAD:3 };
let state = STATE.START;

// ‚îÄ‚îÄ Config  (all velocities are px per 16ms tick, scaled by dt in update)
const GRAVITY    = 0.022;   // acceleration per ms
const FLAP_VEL   = -5.5;    // instant upward velocity on flap
const MAX_VY     = 9;       // terminal fall speed
const PIPE_SPEED = 0.10;    // px per ms  (~1.6px/frame @60fps)
const PIPE_GAP   = 150;
const PIPE_W     = 64;
const PIPE_INTERVAL = 1900; // ms between pipes
const GROUND_H   = 80;

// ‚îÄ‚îÄ Bird
const bird = {
  x: 90, y: H/2 - 20,
  vy: 0, angle: 0,
  flapFrame: 0, flapTimer: 0,
  deadY: 0, deadVy: 0, deadAngle: 0,
  reset(){
    this.x=90; this.y=H/2-20;
    this.vy=0; this.angle=0;
    this.flapFrame=0; this.flapTimer=0;
  },
  flap(){
    this.vy = FLAP_VEL;
    this.flapFrame = 1; this.flapTimer = 0;
    spawnParticles(this.x+16, this.y+12, '#ffe566', 5);
  },
  update(dt){
    this.vy += GRAVITY * dt;
    this.vy  = Math.min(this.vy, MAX_VY);   // cap fall speed
    this.y  += this.vy * (dt / 16);
    this.angle = Math.max(-28, Math.min(90, this.vy * 6));
    this.flapTimer += dt;
    if(this.flapTimer > 120){ this.flapFrame = (this.flapFrame+1)%3; this.flapTimer=0; }
  },
  startDie(){
    this.deadY = this.y; this.deadVy = -4; this.deadAngle = this.angle;
  },
  updateDead(dt){
    this.deadVy += 0.35 * (dt/16);
    this.deadY  += this.deadVy * (dt/16);
    this.deadAngle = Math.min(this.deadAngle + 5*(dt/16), 90);
  }
};

// ‚îÄ‚îÄ Pipes
let pipes = [];
let pipeTimer = 0;
function spawnPipe(){
  const minY = 80, maxY = H - GROUND_H - PIPE_GAP - 80;
  const topH = Math.random()*(maxY-minY)+minY;
  pipes.push({ x:W+10, topH, scored:false });
}

// ‚îÄ‚îÄ Score
let score=0, best=parseInt(localStorage.getItem('cb_best')||'0',10);

// ‚îÄ‚îÄ Particles
let particles=[];
function spawnParticles(x,y,color,n){
  for(let i=0;i<n;i++){
    const angle=Math.random()*Math.PI*2;
    const spd=1+Math.random()*3;
    particles.push({x,y,vx:Math.cos(angle)*spd,vy:Math.sin(angle)*spd,
      life:1,color,size:2+Math.random()*3});
  }
}
function updateParticles(){
  particles=particles.filter(p=>{
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.1; p.life-=0.04;
    return p.life>0;
  });
}

// ‚îÄ‚îÄ Clouds
let clouds=[];
for(let i=0;i<5;i++) clouds.push({x:Math.random()*W,y:20+Math.random()*160,w:60+Math.random()*80,spd:0.3+Math.random()*0.4});

// ‚îÄ‚îÄ Stars (night sky parallax)
let stars=[];
for(let i=0;i<60;i++) stars.push({x:Math.random()*W,y:Math.random()*(H-GROUND_H),size:Math.random()*2,alpha:Math.random()});

// ‚îÄ‚îÄ Ground scroll
let groundOffset=0;

// ‚îÄ‚îÄ Score flash
let scoreFlash=0;

// ‚îÄ‚îÄ Input
function inputAction(){
  if(state===STATE.START){
    startGame();
  } else if(state===STATE.PLAYING){
    bird.flap();
  }
}
document.addEventListener('keydown', e=>{
  if(e.code==='Space'||e.code==='ArrowUp') inputAction();
});
document.addEventListener('pointerdown', e=>{
  if(gameOverPanel.classList.contains('visible')) return;
  inputAction();
});
retryBtn.addEventListener('click', e=>{e.stopPropagation(); startGame();});
shareBtn.addEventListener('click', e=>{
  e.stopPropagation();
  const txt=`I scored ${score} on Clumsy Bird! üê¶ Can you beat me?`;
  if(navigator.share) navigator.share({title:'Clumsy Bird',text:txt}).catch(()=>{});
  else navigator.clipboard.writeText(txt).then(()=>showToast('Copied to clipboard!'));
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DRAW HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function drawSky(){
  // Day-night gradient
  const grad=ctx.createLinearGradient(0,0,0,H-GROUND_H);
  grad.addColorStop(0,'#0d1b4b');
  grad.addColorStop(0.4,'#1a3a6e');
  grad.addColorStop(0.7,'#3a7bd5');
  grad.addColorStop(1,'#7ec8f8');
  ctx.fillStyle=grad; ctx.fillRect(0,0,W,H-GROUND_H);
}

function drawStars(){
  stars.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.size,0,Math.PI*2);
    ctx.fillStyle=`rgba(255,255,240,${s.alpha})`;
    ctx.fill();
  });
}

function drawClouds(){
  ctx.save();
  clouds.forEach(c=>{
    ctx.fillStyle='rgba(255,255,255,0.6)';
    ctx.beginPath();
    ctx.ellipse(c.x,c.y,c.w/2,c.w/5,0,0,Math.PI*2); ctx.fill();
    ctx.beginPath();
    ctx.ellipse(c.x-c.w*0.2,c.y-c.w*0.12,c.w*0.28,c.w*0.18,0,0,Math.PI*2); ctx.fill();
    ctx.beginPath();
    ctx.ellipse(c.x+c.w*0.18,c.y-c.w*0.1,c.w*0.22,c.w*0.15,0,0,Math.PI*2); ctx.fill();
  });
  ctx.restore();
}

function drawMoon(){
  ctx.save();
  ctx.fillStyle='rgba(255,245,180,0.9)';
  ctx.shadowColor='rgba(255,245,180,0.5)'; ctx.shadowBlur=20;
  ctx.beginPath();
  ctx.arc(340,55,28,0,Math.PI*2); ctx.fill();
  // crater
  ctx.fillStyle='rgba(220,210,150,0.5)';
  ctx.beginPath(); ctx.arc(330,48,7,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(348,62,4,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

function drawGround(){
  // dark strip
  ctx.fillStyle='#3e2d1c';
  ctx.fillRect(0,H-GROUND_H,W,GROUND_H);
  // grass top
  ctx.fillStyle='#4daa2e';
  ctx.fillRect(0,H-GROUND_H,W,14);
  ctx.fillStyle='#3a8a20';
  ctx.fillRect(0,H-GROUND_H+14,W,6);
  // dirt scrolling lines
  ctx.strokeStyle='rgba(255,255,255,0.06)';
  ctx.lineWidth=2;
  for(let i=0;i<8;i++){
    const rx=((groundOffset*0.5)%(W/4))+i*(W/4);
    ctx.beginPath();
    ctx.moveTo(rx-50,H-GROUND_H+28);
    ctx.lineTo(rx+50,H-GROUND_H+28);
    ctx.stroke();
  }
}

function drawPipe(x, topH){
  const botY = topH + PIPE_GAP;
  const botH = H - GROUND_H - botY;
  const grad = ctx.createLinearGradient(x,0,x+PIPE_W,0);
  grad.addColorStop(0,'#5ac626'); grad.addColorStop(0.4,'#7ee84a'); grad.addColorStop(1,'#3a9010');

  // top pipe body
  ctx.fillStyle=grad;
  ctx.fillRect(x,0,PIPE_W,topH-18);
  // top cap
  ctx.fillRect(x-6,topH-28,PIPE_W+12,28);
  // highlights
  ctx.fillStyle='rgba(255,255,255,0.18)';
  ctx.fillRect(x+8,0,10,topH-18);

  // bottom pipe body
  ctx.fillStyle=grad;
  ctx.fillRect(x,botY+18,PIPE_W,botH);
  // bottom cap
  ctx.fillRect(x-6,botY,PIPE_W+12,28);
  ctx.fillStyle='rgba(255,255,255,0.18)';
  ctx.fillRect(x+8,botY+28,10,botH);

  // border
  ctx.strokeStyle='#2a7800'; ctx.lineWidth=2.5;
  ctx.strokeRect(x,0,PIPE_W,topH-18);
  ctx.strokeRect(x-6,topH-28,PIPE_W+12,28);
  ctx.strokeRect(x,botY+18,PIPE_W,botH);
  ctx.strokeRect(x-6,botY,PIPE_W+12,28);
}

// Wing positions for 3 frames: up, mid, down
const WING_Y = [-10, 0, 10];

function drawBird(bx, by, angle, frame, dead=false){
  ctx.save();
  ctx.translate(bx+20, by+18);
  ctx.rotate(angle*Math.PI/180);

  // shadow
  ctx.fillStyle='rgba(0,0,0,0.18)';
  ctx.beginPath(); ctx.ellipse(0,20,18,6,0,0,Math.PI*2); ctx.fill();

  // body
  const bodyGrad=ctx.createRadialGradient(-4,-4,2,0,0,22);
  bodyGrad.addColorStop(0,'#ffe97a');
  bodyGrad.addColorStop(0.6,'#f5c518');
  bodyGrad.addColorStop(1,'#c99600');
  ctx.fillStyle=bodyGrad;
  ctx.beginPath();
  ctx.ellipse(0,0,20,16,0,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle='#9a6e00'; ctx.lineWidth=2; ctx.stroke();

  // wing
  ctx.fillStyle='#f0a800';
  ctx.beginPath();
  const wy=WING_Y[frame];
  ctx.ellipse(-8,wy,12,7,Math.PI*0.15,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle='#9a6e00'; ctx.lineWidth=1.5; ctx.stroke();

  // belly
  ctx.fillStyle='rgba(255,245,200,0.7)';
  ctx.beginPath();
  ctx.ellipse(4,4,12,9,0.2,0,Math.PI*2); ctx.fill();

  // eye white
  ctx.fillStyle='white';
  ctx.beginPath(); ctx.arc(10,-4,7,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle='#555'; ctx.lineWidth=1.5; ctx.stroke();

  if(dead){
    // X eyes
    ctx.strokeStyle='#333'; ctx.lineWidth=2.5;
    ['M 7,-7 L 13,-1','M 13,-7 L 7,-1'].forEach(d=>{
      const p=new Path2D(d); ctx.stroke(p);
    });
  } else {
    // pupil
    ctx.fillStyle='#1a1a1a';
    ctx.beginPath(); ctx.arc(11,-4,3.5,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='white';
    ctx.beginPath(); ctx.arc(12,-5,1.2,0,Math.PI*2); ctx.fill();
  }

  // beak
  ctx.fillStyle='#e96c0a';
  ctx.beginPath();
  ctx.moveTo(16,-2); ctx.lineTo(26,0); ctx.lineTo(16,4);
  ctx.closePath(); ctx.fill();
  ctx.strokeStyle='#b04800'; ctx.lineWidth=1.5; ctx.stroke();

  ctx.restore();
}

function drawScore(){
  const s = score.toString();
  ctx.save();
  ctx.font = 'bold 54px Bangers, cursive';
  ctx.textAlign='center';
  ctx.shadowColor='rgba(0,0,0,0.5)'; ctx.shadowBlur=8;

  if(scoreFlash>0){
    const sc = 1+scoreFlash*0.3;
    ctx.translate(W/2,52);
    ctx.scale(sc,sc);
    ctx.translate(-W/2,-52);
    ctx.fillStyle='#ffe566';
  } else {
    ctx.fillStyle='white';
  }
  ctx.strokeStyle='rgba(0,0,0,0.5)'; ctx.lineWidth=5;
  ctx.strokeText(s,W/2,62);
  ctx.fillText(s,W/2,62);
  ctx.restore();
}

function drawParticles(){
  particles.forEach(p=>{
    ctx.globalAlpha=p.life;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
  });
  ctx.globalAlpha=1;
}

// Draw the mini bird on the start screen preview canvas
(function drawPreviewBird(){
  const pc=document.getElementById('birdPreview');
  const pctx=pc.getContext('2d');
  let f=0;
  setInterval(()=>{
    pctx.clearRect(0,0,80,64);
    pctx.save();
    pctx.translate(40,32);
    pctx.rotate(Math.sin(Date.now()*0.003)*0.15);
    // body
    const g=pctx.createRadialGradient(-4,-4,2,0,0,22);
    g.addColorStop(0,'#ffe97a'); g.addColorStop(0.6,'#f5c518'); g.addColorStop(1,'#c99600');
    pctx.fillStyle=g;
    pctx.beginPath(); pctx.ellipse(0,0,20,16,0,0,Math.PI*2); pctx.fill();
    pctx.strokeStyle='#9a6e00'; pctx.lineWidth=2; pctx.stroke();
    // wing
    pctx.fillStyle='#f0a800';
    pctx.beginPath();
    const wy2=WING_Y[f];
    pctx.ellipse(-8,wy2,12,7,Math.PI*0.15,0,Math.PI*2); pctx.fill();
    pctx.strokeStyle='#9a6e00'; pctx.lineWidth=1.5; pctx.stroke();
    // eye
    pctx.fillStyle='white'; pctx.beginPath(); pctx.arc(10,-4,7,0,Math.PI*2); pctx.fill();
    pctx.strokeStyle='#555'; pctx.lineWidth=1.5; pctx.stroke();
    pctx.fillStyle='#1a1a1a'; pctx.beginPath(); pctx.arc(11,-4,3.5,0,Math.PI*2); pctx.fill();
    pctx.fillStyle='white'; pctx.beginPath(); pctx.arc(12,-5,1.2,0,Math.PI*2); pctx.fill();
    // beak
    pctx.fillStyle='#e96c0a';
    pctx.beginPath(); pctx.moveTo(16,-2); pctx.lineTo(26,0); pctx.lineTo(16,4); pctx.closePath(); pctx.fill();
    pctx.restore();
    f=(f+1)%3;
  },150);
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COLLISION DETECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkCollision(){
  const bx=bird.x+5, by=bird.y+5, bw=30, bh=26;
  // Ground / ceiling
  if(bird.y+bh >= H-GROUND_H || bird.y<=0) return true;
  for(const p of pipes){
    const px=p.x-6, pw=PIPE_W+12;
    const botY=p.topH+PIPE_GAP;
    // top pipe cap area
    if(bx+bw>px && bx<px+pw){
      if(by<p.topH || by+bh>botY) return true;
    }
  }
  return false;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME LIFECYCLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startGame(){
  score=0; pipes=[]; particles=[];
  bird.reset();
  pipeTimer=0;
  state=STATE.PLAYING;
  liveScoreEl.textContent='0';
  liveBestEl.textContent=best;
  startPanel.classList.remove('visible'); startPanel.classList.add('hidden');
  gameOverPanel.classList.remove('visible'); gameOverPanel.classList.add('hidden');
  bird.flap();
}

function triggerDeath(){
  state=STATE.DYING;
  bird.startDie();
  spawnParticles(bird.x+20,bird.y+18,'#ffe566',14);
  spawnParticles(bird.x+20,bird.y+18,'#e94e3d',8);
  // Flash screen
  let flashes=0;
  const fi=setInterval(()=>{
    if(++flashes>=5){ clearInterval(fi); showGameOver(); }
  },80);
}

function showGameOver(){
  state=STATE.DEAD;
  const isNew=score>best;
  if(isNew){ best=score; localStorage.setItem('cb_best',best); }
  liveBestEl.textContent = best;

  goScore.textContent=score;
  goBest.textContent=best;
  newBadge.style.display=isNew?'inline-block':'none';

  // Medal
  let medalClass='medal-none',medalIcon='üíÄ',stars=0;
  if(score>=40){medalClass='medal-gold';medalIcon='ü•á';stars=3;}
  else if(score>=20){medalClass='medal-silver';medalIcon='ü•à';stars=3;}
  else if(score>=10){medalClass='medal-bronze';medalIcon='ü•â';stars=2;}
  else if(score>=5){medalClass='medal-bronze';medalIcon='ü•â';stars=1;}
  goMedal.className='medal '+medalClass;
  goMedal.textContent=medalIcon;
  ['st1','st2','st3'].forEach((id,i)=>{
    const el=document.getElementById(id);
    el.classList.remove('lit');
    if(i<stars) setTimeout(()=>el.classList.add('lit'),(i+1)*200+500);
  });

  gameOverPanel.classList.remove('hidden'); gameOverPanel.classList.add('visible');
}

function showToast(msg){
  toast.textContent=msg;
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),2500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MAIN LOOP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let lastTime=0, deathTimer=0;

function loop(ts){
  const dt=Math.min(ts-lastTime,50); lastTime=ts;

  ctx.clearRect(0,0,W,H);

  // Background
  drawSky();
  drawStars();
  drawMoon();
  drawClouds();

  // Update clouds
  clouds.forEach(c=>{
    c.x-=c.spd*(dt/16);
    if(c.x+c.w/2<0) c.x=W+c.w;
  });

  if(state===STATE.PLAYING){
    // Update
    pipeTimer+=dt;
    if(pipeTimer>PIPE_INTERVAL){ pipeTimer=0; spawnPipe(); }

    pipes=pipes.filter(p=>{
      p.x -= PIPE_SPEED * dt;
      // Score
      if(!p.scored && p.x+PIPE_W<bird.x){
        p.scored=true; score++;
        scoreFlash=1;
        spawnParticles(bird.x+20,bird.y,'#ffe566',8);
        updateSidebarScore();
      }
      return p.x>-PIPE_W-20;
    });
    if(scoreFlash>0) scoreFlash=Math.max(0,scoreFlash - (dt/16)*0.08);

    bird.update(dt);
    groundOffset += PIPE_SPEED * dt;
    updateParticles();

    if(checkCollision()) triggerDeath();
  }

  // Draw pipes
  pipes.forEach(p=>drawPipe(p.x,p.topH));

  drawGround();

  // Draw bird
  if(state===STATE.DYING || state===STATE.DEAD){
    const deadBird=bird;
    if(state===STATE.DYING){ deadBird.updateDead(dt); deathTimer+=dt; }
    drawBird(deadBird.x, deadBird.deadY, deadBird.deadAngle, 0, true);
  } else {
    drawBird(bird.x, bird.y, bird.angle, bird.flapFrame, false);
  }

  drawParticles();

  if(state===STATE.PLAYING || state===STATE.DYING){
    drawScore();
  }

  // Start screen idle animation ‚Äî bird bobs
  if(state===STATE.START){
    bird.y = H/2-20 + Math.sin(ts*0.002)*12;
    drawBird(bird.x,bird.y,Math.sin(ts*0.002)*8,Math.floor(ts/150)%3,false);
    drawScore();
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
